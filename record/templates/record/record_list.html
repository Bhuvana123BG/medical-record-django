{% extends 'record/base.html' %}
{% block title %}Medical Records{% endblock %}
{% load highlight %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-info">Your Medical Records</h2>
    <form method="get" action="{% url 'record_list' %}" class="d-flex align-items-center gap-2 flex-wrap">
      
      <input 
        type="text"  
        name="q" 
        class="form-control border-info bg-dark text-light px-2 py-1"
        placeholder="Search" 
        value="{{ query|default:'' }}" 
        style="width: 180px; font-size: 0.9rem;">
      
      <select 
        name="doctor" 
        class="form-select border-info bg-dark text-light px-2 py-1" 
        style="width: 170px; font-size: 0.9rem;">
        <option value="">All Doctors</option>
        {% for doc in doctors %}
          <option value="{{ doc.id }}" {% if doctor_filter|default:'' == doc.id|stringformat:'s' %}selected{% endif %}>
            {{ doc.name }}
          </option>
        {% endfor %}
      </select>
  
      <button class="btn btn-outline-info py-1 px-3" type="submit">
        <i class="bi bi-search"></i>
      </button>
    </form>
  </div>
  
  
  <div class="container d-flex justify-content-end my-2">
    <a href="{% url 'add_record' %}" class="btn btn-info btn-sm fw-semibold">
      + Add Record
    </a>
  </div>
  


{% if page_obj %}
  <div class="table-responsive">
    <table class="table table-striped table-hover table-bordered text-center align-middle">
      <thead class="table-info">
        <tr>
          <th>Doctor</th>
          <th>Date of Visit</th>
          <th>Purpose</th>
          <th>Prescription</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for record in page_obj %}
          <tr>
            <td>{{ record.doctor.name }}</td>
            <td>{{ record.date_of_visit }}</td>
            <td>{{ record.purpose }}</td>
            <td>
              {% if record.prescription_url %}
                <a href="{{ record.prescription_url }}" target="_blank" class="btn btn-sm btn-info me-1">View</a>
              {% else %}
                <span class="text-muted">No Prescription</span>
              {% endif %}
              {% if record.summary %}
                <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#summaryModal{{ record.id }}">
                  Summary
                </button>
              {% endif %}
            </td>
            <td>
              <a href="{% url 'edit_record' record.id %}" class="btn btn-sm btn-warning me-1">Edit</a>
              <a href="{% url 'delete_record' record.id %}" class="btn btn-sm btn-danger">Delete</a>
            </td>
          </tr>

        
          {% if record.summary %}
        
<div class="modal fade" id="summaryModal{{ record.id }}" tabindex="-1" aria-labelledby="summaryModalLabel{{ record.id }}" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content border-0 shadow-lg bg-gradient-dark text-white rounded-4">
        <div class="modal-header border-0 bg-info bg-opacity-25 rounded-top-4 px-4 py-3">
          <h5 class="modal-title w-100 text-center text-info fs-4 fw-bold" id="summaryModalLabel{{ record.id }}">
            üìù Summary
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body fs-6 px-4 py-3" style="max-height: 60vh; overflow-y: auto; line-height: 1.8;">
            {% if record.summary %}
            {{ record.summary|linebreaksbr|highlight_keywords|safe }}

          {% else %}
            <p class="text-muted">No summary available.</p>
          {% endif %}
        </div>
        <div class="modal-footer border-0 justify-content-center bg-dark rounded-bottom-4 py-3">
          <button type="button" class="btn btn-outline-info px-4 fw-semibold" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  
          {% endif %}

        {% empty %}
          <tr>
            <td colspan="5" class="text-center">No records found.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    
  </div>
    

   


  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center mt-4">
      {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page=1" aria-label="First">&laquo;</a>
        </li>
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">&lsaquo;</a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <span class="page-link">&laquo;</span>
        </li>
        <li class="page-item disabled">
          <span class="page-link">&lsaquo;</span>
        </li>
      {% endif %}

      <li class="page-item active" aria-current="page">
        <span class="page-link">
          {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
        </span>
      </li>

      {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">&rsaquo;</a>
        </li>
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}" aria-label="Last">&raquo;</a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <span class="page-link">&rsaquo;</span>
        </li>
        <li class="page-item disabled">
          <span class="page-link">&raquo;</span>
        </li>
      {% endif %}
    </ul>
  </nav>

{% else %}
  <p>No records to show.</p>
{% endif %}



{% endblock %}
<style>
    .modal-content {
      background: linear-gradient(145deg, #1f1f1f, #2a2a2a);
      border: 1px solid #444;
    }
    .modal-title {
      letter-spacing: 0.5px;
    }
    mark {
      background-color: #ffc107;
      color: black;
      padding: 2px 4px;
      border-radius: 4px;
      font-weight: 500;
    }
  </style>
  
