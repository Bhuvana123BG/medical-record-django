{% extends 'record/base.html' %}

{% block title %}Edit Medical Record{% endblock %}

{% block content %}
<h2>Edit Medical Record</h2>

{% if errors %}
  <div class="alert alert-danger">
    <ul class="mb-0">
      {% for error in errors %}
        <li>{{ error }}</li>
      {% endfor %}
    </ul>
  </div>
{% endif %}

<form method="POST" enctype="multipart/form-data" novalidate>
    {% csrf_token %}
    <div class="mb-3">
        <label for="doctor" class="form-label">Doctor:</label>
        <select name="doctor" id="doctor" class="form-select" required>
            <option value="">Select a doctor</option>
            {% for doctor in doctors %}
                <option value="{{ doctor.id }}"
                  {% if form_data.doctor_id|stringformat:"s" == doctor.id|stringformat:"s" %}selected{% endif %}>
                  {{ doctor.name }}
                </option>
            {% endfor %}
        </select>
    </div>

    <div class="mb-3">
        <label for="date_of_visit" class="form-label">Date of Visit:</label>
        <input type="date" id="date_of_visit" name="date_of_visit" class="form-control" required
            value="{{ form_data.date_of_visit }}">
    </div>

    <div class="mb-3">
        <label for="purpose" class="form-label">Purpose:</label>
        <input type="text" id="purpose" name="purpose" class="form-control" required
            value="{{ form_data.purpose }}">
    </div>

    <div class="mb-3">
        <label for="prescription" class="form-label">Prescription (Optional):</label>
        <input type="file" id="prescription" name="prescription" class="form-control">

        {% if record.prescription %}
            <p class="mt-2">Current:
                <a href="{{ record.prescription.url }}" target="_blank" class="text-info fw-semibold">View</a>
            </p>
        {% else %}
            <p class="mt-2 text-muted">No file uploaded.</p>
        {% endif %}
    </div>

    <button type="submit" class="btn btn-primary">Update Record</button>
</form>
{% endblock %}
